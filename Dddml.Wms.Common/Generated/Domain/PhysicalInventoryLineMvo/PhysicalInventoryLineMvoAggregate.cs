// <autogenerated>
//   This file was generated by T4 code generator GeneratePhysicalInventoryLineMvoDomain.tt.
//   Any changes made to this file manually will be lost next time the file is regenerated.
// </autogenerated>

using System;
using System.Collections.Generic;
using Dddml.Wms.Specialization;
using Dddml.Wms.Domain;
using Dddml.Wms.Domain.PhysicalInventoryLineMvo;
using Dddml.Wms.Domain.PhysicalInventory;

namespace Dddml.Wms.Domain.PhysicalInventoryLineMvo
{
    public partial class PhysicalInventoryLineMvoAggregate : AggregateBase, IPhysicalInventoryLineMvoAggregate
    {

        readonly IPhysicalInventoryLineMvoState _state;

        readonly IList<IEvent> _changes = new List<IEvent>();

        public IPhysicalInventoryLineMvoState State
        {
            get
            {
                return _state;
            }
        }

        public IList<IEvent> Changes
        {
            get
            {
                return _changes;
            }
        }

        #region IIdentity implementation

        PhysicalInventoryLineId IGlobalIdentity<PhysicalInventoryLineId>.GlobalId
        {
            get
            {
                return this._state.GlobalId;
            }
        }

        #endregion


        public PhysicalInventoryLineMvoAggregate(IPhysicalInventoryLineMvoState state)
        {
            _state = state;
        }


        public virtual void ThrowOnInvalidStateTransition(ICommand c)
        {
            if (((IPhysicalInventoryLineMvoStateProperties)_state).PhysicalInventoryVersion == PhysicalInventoryLineMvoState.VersionZero)
            {
                if (IsCommandCreate((IPhysicalInventoryLineMvoCommand)c))
                {
                    return;
                }
                throw DomainError.Named("premature", "Can't do anything to unexistent aggregate");
            }
            if (_state.Deleted)
            {
                throw DomainError.Named("zombie", "Can't do anything to deleted aggregate.");
            }
            if (IsCommandCreate((IPhysicalInventoryLineMvoCommand)c))
                throw DomainError.Named("rebirth", "Can't create aggregate that already exists");
        }

        private static bool IsCommandCreate(IPhysicalInventoryLineMvoCommand c)
        {
            return c.PhysicalInventoryVersion == PhysicalInventoryLineMvoState.VersionZero;
        }

        protected internal virtual void Apply(IEvent e)
        {
            OnApplying(e);
            _state.Mutate(e);
            _changes.Add(e);
        }

        public virtual void Create(ICreatePhysicalInventoryLineMvo c)
        {
            IPhysicalInventoryLineMvoStateCreated e = Map(c);
            Apply(e);
        }

        public virtual void MergePatch(IMergePatchPhysicalInventoryLineMvo c)
        {
            IPhysicalInventoryLineMvoStateMergePatched e = Map(c);
            Apply(e);
        }

        public virtual void Delete(IDeletePhysicalInventoryLineMvo c)
        {
            IPhysicalInventoryLineMvoStateDeleted e = Map(c);
            Apply(e);
        }


        protected virtual IPhysicalInventoryLineMvoStateCreated Map(ICreatePhysicalInventoryLineMvo c)
        {
			var stateEventId = new PhysicalInventoryLineMvoEventId(c.PhysicalInventoryLineId, c.PhysicalInventoryVersion);
            IPhysicalInventoryLineMvoStateCreated e = NewPhysicalInventoryLineMvoStateCreated(stateEventId);
		
            e.BookQuantity = c.BookQuantity;
            e.CountedQuantity = c.CountedQuantity;
            e.Processed = c.Processed;
            e.LineNumber = c.LineNumber;
            e.ReversalLineNumber = c.ReversalLineNumber;
            e.Description = c.Description;
            e.Version = c.Version;
            e.PhysicalInventoryDocumentStatusId = c.PhysicalInventoryDocumentStatusId;
            e.PhysicalInventoryWarehouseId = c.PhysicalInventoryWarehouseId;
            e.PhysicalInventoryLocatorIdPattern = c.PhysicalInventoryLocatorIdPattern;
            e.PhysicalInventoryProductIdPattern = c.PhysicalInventoryProductIdPattern;
            e.PhysicalInventoryPosted = c.PhysicalInventoryPosted;
            e.PhysicalInventoryProcessed = c.PhysicalInventoryProcessed;
            e.PhysicalInventoryProcessing = c.PhysicalInventoryProcessing;
            e.PhysicalInventoryDocumentTypeId = c.PhysicalInventoryDocumentTypeId;
            e.PhysicalInventoryMovementDate = c.PhysicalInventoryMovementDate;
            e.PhysicalInventoryDescription = c.PhysicalInventoryDescription;
            e.PhysicalInventoryIsApproved = c.PhysicalInventoryIsApproved;
            e.PhysicalInventoryApprovalAmount = c.PhysicalInventoryApprovalAmount;
            e.PhysicalInventoryIsQuantityUpdated = c.PhysicalInventoryIsQuantityUpdated;
            e.PhysicalInventoryReversalDocumentNumber = c.PhysicalInventoryReversalDocumentNumber;
            e.PhysicalInventoryCreatedBy = c.PhysicalInventoryCreatedBy;
            e.PhysicalInventoryCreatedAt = c.PhysicalInventoryCreatedAt;
            e.PhysicalInventoryUpdatedBy = c.PhysicalInventoryUpdatedBy;
            e.PhysicalInventoryUpdatedAt = c.PhysicalInventoryUpdatedAt;
            e.PhysicalInventoryActive = c.PhysicalInventoryActive;
            e.CommandId = c.CommandId;


            e.CreatedBy = (string)c.RequesterId;
            e.CreatedAt = ApplicationContext.Current.TimestampService.Now<DateTime>();
			var physicalInventoryVersion = c.PhysicalInventoryVersion;


            return e;
        }

        protected virtual IPhysicalInventoryLineMvoStateMergePatched Map(IMergePatchPhysicalInventoryLineMvo c)
        {
			var stateEventId = new PhysicalInventoryLineMvoEventId(c.PhysicalInventoryLineId, c.PhysicalInventoryVersion);
            IPhysicalInventoryLineMvoStateMergePatched e = NewPhysicalInventoryLineMvoStateMergePatched(stateEventId);

            e.BookQuantity = c.BookQuantity;
            e.CountedQuantity = c.CountedQuantity;
            e.Processed = c.Processed;
            e.LineNumber = c.LineNumber;
            e.ReversalLineNumber = c.ReversalLineNumber;
            e.Description = c.Description;
            e.Version = c.Version;
            e.PhysicalInventoryDocumentStatusId = c.PhysicalInventoryDocumentStatusId;
            e.PhysicalInventoryWarehouseId = c.PhysicalInventoryWarehouseId;
            e.PhysicalInventoryLocatorIdPattern = c.PhysicalInventoryLocatorIdPattern;
            e.PhysicalInventoryProductIdPattern = c.PhysicalInventoryProductIdPattern;
            e.PhysicalInventoryPosted = c.PhysicalInventoryPosted;
            e.PhysicalInventoryProcessed = c.PhysicalInventoryProcessed;
            e.PhysicalInventoryProcessing = c.PhysicalInventoryProcessing;
            e.PhysicalInventoryDocumentTypeId = c.PhysicalInventoryDocumentTypeId;
            e.PhysicalInventoryMovementDate = c.PhysicalInventoryMovementDate;
            e.PhysicalInventoryDescription = c.PhysicalInventoryDescription;
            e.PhysicalInventoryIsApproved = c.PhysicalInventoryIsApproved;
            e.PhysicalInventoryApprovalAmount = c.PhysicalInventoryApprovalAmount;
            e.PhysicalInventoryIsQuantityUpdated = c.PhysicalInventoryIsQuantityUpdated;
            e.PhysicalInventoryReversalDocumentNumber = c.PhysicalInventoryReversalDocumentNumber;
            e.PhysicalInventoryCreatedBy = c.PhysicalInventoryCreatedBy;
            e.PhysicalInventoryCreatedAt = c.PhysicalInventoryCreatedAt;
            e.PhysicalInventoryUpdatedBy = c.PhysicalInventoryUpdatedBy;
            e.PhysicalInventoryUpdatedAt = c.PhysicalInventoryUpdatedAt;
            e.PhysicalInventoryActive = c.PhysicalInventoryActive;
            e.IsPropertyBookQuantityRemoved = c.IsPropertyBookQuantityRemoved;
            e.IsPropertyCountedQuantityRemoved = c.IsPropertyCountedQuantityRemoved;
            e.IsPropertyProcessedRemoved = c.IsPropertyProcessedRemoved;
            e.IsPropertyLineNumberRemoved = c.IsPropertyLineNumberRemoved;
            e.IsPropertyReversalLineNumberRemoved = c.IsPropertyReversalLineNumberRemoved;
            e.IsPropertyDescriptionRemoved = c.IsPropertyDescriptionRemoved;
            e.IsPropertyVersionRemoved = c.IsPropertyVersionRemoved;
            e.IsPropertyPhysicalInventoryDocumentStatusIdRemoved = c.IsPropertyPhysicalInventoryDocumentStatusIdRemoved;
            e.IsPropertyPhysicalInventoryWarehouseIdRemoved = c.IsPropertyPhysicalInventoryWarehouseIdRemoved;
            e.IsPropertyPhysicalInventoryLocatorIdPatternRemoved = c.IsPropertyPhysicalInventoryLocatorIdPatternRemoved;
            e.IsPropertyPhysicalInventoryProductIdPatternRemoved = c.IsPropertyPhysicalInventoryProductIdPatternRemoved;
            e.IsPropertyPhysicalInventoryPostedRemoved = c.IsPropertyPhysicalInventoryPostedRemoved;
            e.IsPropertyPhysicalInventoryProcessedRemoved = c.IsPropertyPhysicalInventoryProcessedRemoved;
            e.IsPropertyPhysicalInventoryProcessingRemoved = c.IsPropertyPhysicalInventoryProcessingRemoved;
            e.IsPropertyPhysicalInventoryDocumentTypeIdRemoved = c.IsPropertyPhysicalInventoryDocumentTypeIdRemoved;
            e.IsPropertyPhysicalInventoryMovementDateRemoved = c.IsPropertyPhysicalInventoryMovementDateRemoved;
            e.IsPropertyPhysicalInventoryDescriptionRemoved = c.IsPropertyPhysicalInventoryDescriptionRemoved;
            e.IsPropertyPhysicalInventoryIsApprovedRemoved = c.IsPropertyPhysicalInventoryIsApprovedRemoved;
            e.IsPropertyPhysicalInventoryApprovalAmountRemoved = c.IsPropertyPhysicalInventoryApprovalAmountRemoved;
            e.IsPropertyPhysicalInventoryIsQuantityUpdatedRemoved = c.IsPropertyPhysicalInventoryIsQuantityUpdatedRemoved;
            e.IsPropertyPhysicalInventoryReversalDocumentNumberRemoved = c.IsPropertyPhysicalInventoryReversalDocumentNumberRemoved;
            e.IsPropertyPhysicalInventoryCreatedByRemoved = c.IsPropertyPhysicalInventoryCreatedByRemoved;
            e.IsPropertyPhysicalInventoryCreatedAtRemoved = c.IsPropertyPhysicalInventoryCreatedAtRemoved;
            e.IsPropertyPhysicalInventoryUpdatedByRemoved = c.IsPropertyPhysicalInventoryUpdatedByRemoved;
            e.IsPropertyPhysicalInventoryUpdatedAtRemoved = c.IsPropertyPhysicalInventoryUpdatedAtRemoved;
            e.IsPropertyPhysicalInventoryActiveRemoved = c.IsPropertyPhysicalInventoryActiveRemoved;

            e.CommandId = c.CommandId;


            e.CreatedBy = (string)c.RequesterId;
            e.CreatedAt = ApplicationContext.Current.TimestampService.Now<DateTime>();

			var physicalInventoryVersion = c.PhysicalInventoryVersion;


            return e;
        }

        protected virtual IPhysicalInventoryLineMvoStateDeleted Map(IDeletePhysicalInventoryLineMvo c)
        {
			var stateEventId = new PhysicalInventoryLineMvoEventId(c.PhysicalInventoryLineId, c.PhysicalInventoryVersion);
            IPhysicalInventoryLineMvoStateDeleted e = NewPhysicalInventoryLineMvoStateDeleted(stateEventId);
			
            e.CommandId = c.CommandId;


            e.CreatedBy = (string)c.RequesterId;
            e.CreatedAt = ApplicationContext.Current.TimestampService.Now<DateTime>();


            return e;
        }

        private void ThrowOnInconsistentIds(object innerObject, string innerIdName, object innerIdValue, string outerIdName, object outerIdValue)
        {
            if (!Object.Equals(innerIdValue, outerIdValue))
            {
                if (innerIdValue is string && outerIdValue is string && ((string)innerIdValue).Normalize() == ((string)outerIdValue).Normalize())
                {
                    return;
                }
                throw DomainError.Named("inconsistentId", "Outer {0} {1} NOT equals inner {2} {3}", outerIdName, outerIdValue, innerIdName, innerIdValue);
            }
        }

////////////////////////

        protected PhysicalInventoryLineMvoStateCreated NewPhysicalInventoryLineMvoStateCreated(long version, string commandId, string requesterId)
        {
            var stateEventId = new PhysicalInventoryLineMvoEventId(_state.PhysicalInventoryLineId, version);
            var e = NewPhysicalInventoryLineMvoStateCreated(stateEventId);

            e.CommandId = commandId;

            e.CreatedBy = (string)requesterId;
            e.CreatedAt = ApplicationContext.Current.TimestampService.Now<DateTime>();

            return e;
        }

        protected PhysicalInventoryLineMvoStateMergePatched NewPhysicalInventoryLineMvoStateMergePatched(long version, string commandId, string requesterId)
        {
            var stateEventId = new PhysicalInventoryLineMvoEventId(_state.PhysicalInventoryLineId, version);
            var e = NewPhysicalInventoryLineMvoStateMergePatched(stateEventId);

            e.CommandId = commandId;

            e.CreatedBy = (string)requesterId;
            e.CreatedAt = ApplicationContext.Current.TimestampService.Now<DateTime>();

            return e;
        }


        protected PhysicalInventoryLineMvoStateDeleted NewPhysicalInventoryLineMvoStateDeleted(long version, string commandId, string requesterId)
        {
            var stateEventId = new PhysicalInventoryLineMvoEventId(_state.PhysicalInventoryLineId, version);
            var e = NewPhysicalInventoryLineMvoStateDeleted(stateEventId);

            e.CommandId = commandId;

            e.CreatedBy = (string)requesterId;
            e.CreatedAt = ApplicationContext.Current.TimestampService.Now<DateTime>();

            return e;
        }

////////////////////////

		private PhysicalInventoryLineMvoStateCreated NewPhysicalInventoryLineMvoStateCreated(PhysicalInventoryLineMvoEventId stateEventId)
		{
			return new PhysicalInventoryLineMvoStateCreated(stateEventId);			
		}

        private PhysicalInventoryLineMvoStateMergePatched NewPhysicalInventoryLineMvoStateMergePatched(PhysicalInventoryLineMvoEventId stateEventId)
		{
			return new PhysicalInventoryLineMvoStateMergePatched(stateEventId);
		}

        private PhysicalInventoryLineMvoStateDeleted NewPhysicalInventoryLineMvoStateDeleted(PhysicalInventoryLineMvoEventId stateEventId)
		{
			return new PhysicalInventoryLineMvoStateDeleted(stateEventId);
		}
    }

}

