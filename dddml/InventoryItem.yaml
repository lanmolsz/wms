#%DDDML 0.1

---

# ------------------------------
aggregates:
              
    # --------------- aggregate ---------------
    InventoryItem:
      
      id:
        name: InventoryItemId
        type: InventoryItemId

      properties:
      
        QuantityOnHand:
          type: decimal
        QuantityReserved:
          type: decimal
        QuantityOccupied:
          type: decimal
        QuantityVirtual:
          type: decimal
        
        Entries:
          itemType: InventoryItemEntry
      
      reservedProperties:
        noActive: true
        noDeleted: true
      
      entities:
      
        # --------------- 库存事务 / 分录 ------------------
        InventoryItemEntry:
          immutable: True
          
          id:
            name: EntrySeqId
            type: long
            columnName: EntrySeqId
            
          properties:
          
            QuantityOnHand:
              type: decimal
            QuantityReserved:
              type: decimal
            QuantityOccupied:
              type: decimal
            QuantityVirtual:
              type: decimal
            
            Source:
              type: InventoryItemSourceVO
              notNull: true
              
          reservedProperties:
            noActive: true
      
      # --------------- Accounts -------------------
      accounts:
        QuantityOnHand:
          entryEntityName: "InventoryItemEntry"
          entryAmountPropertyName: "QuantityOnHand"
        QuantityReserved:
          entryEntityName: "InventoryItemEntry"
          entryAmountPropertyName: "QuantityReserved"
        QuantityOccupied:
          entryEntityName: "InventoryItemEntry"
          entryAmountPropertyName: "QuantityOccupied"
        QuantityVirtual:
          entryEntityName: "InventoryItemEntry"
          entryAmountPropertyName: "QuantityVirtual"
      
      metadata:
        # NoEventSourcing: true
        AggregateEventListenerName: inventoryItemEventListener
      
      # ---------------- Value Objects -------------------
      valueObjects:
      
        # ----------------------------------
        InventoryItemId:
          properties:
            ProductId:
              type: string
              columnName: ProductId
            LocatorId: 
              type: string
              columnName: LocatorId
            AttributeSetInstanceId:
              type: string
              columnName: AttributeSetInstanceId
        
        # -----------------------------------
        InventoryItemSourceVO:
          properties:
            DocumentTypeId:
              type: string
              referenceType: DocumentType
              notNull: true
              columnName: DocumentTypeId
            DocumentNumber:
              type: string
              notNull: true
              columnName: DocumentNumber
            LineNumber:
              type: string
              columnName: LineNumber
            
    # ----------------------- aggregate -------------------------
    DocumentType:
      id:
        name: DocumentTypeId
        type: string
      properties:
        Description:
          type: string
          notNull: true
          
          
    # --------------- aggregate ---------------
    SellableInventoryItem:
      id: 
        name: SellableInventoryItemId
        type: InventoryItemId
        
      properties:
        QuantitySellable:
          type: decimal
        Entries:
          itemType: SellableInventoryItemEntry
          
      reservedProperties:
        noActive: true
        noDeleted: true
        
      entities:
        SellableInventoryItemEntry:
          immutable: True
          id:
            name: EntrySeqId
            type: long
            columnName: EntrySeqId
          properties:
            QuantitySellable:
              type: decimal
            SourceEventId:
              type: InventoryPRTriggeredId
              referenceType: InventoryPRTriggered
              notNull: true
              columnNamePrefix: "SrcEvent"
          reservedProperties:
            noActive: true
            
      accounts:
        QuantitySellable:
          entryEntityName: "SellableInventoryItemEntry"
          entryAmountPropertyName: "QuantitySellable"
          
      metadata:
        NoEventSourcing: true
            
    # --------------- aggregate ---------------
    InventoryPostingRule:
      id:
        name: InventoryPostingRuleId
        type: string
      properties:
        Trigger:
          type: InventoryItemId
        Output:
          type: InventoryItemId
        AccountName:
          type: string
        # 输出的数量是否需要“取反”  
        IsOutputNegated:
          type: bool
          
    # --------------- aggregate ---------------
    InventoryPRTriggered:
      id:
        name: InventoryPRTriggeredId
        type: InventoryPRTriggeredId
      properties:
        IsProcessed:
          type: bool
          notNull: true
      reservedProperties:
        noActive: true
        noDeleted: true
      valueObjects:
        InventoryPRTriggeredId:
          properties:
            SourceEntryId:
              type: InventoryItemEntryId
              referenceType: InventoryItemEntry
            InventoryPostingRuleId:
              type: string
              referenceType: InventoryPostingRule
              columnName: InventoryPostingRuleId
      metadata:
        NoEventSourcing: true
    
    # --------------- aggregate ---------------
    # InventoryPostingRuleType:
      # id:
        # name: InventoryPostingRuleTypeId
        # type: string
      # properties:
        # Description:
          # type: string
          # notNull: true
          