#%DDDML 0.1

---

# ------------------------------
aggregates:

  # ------------------------------
  # 装运单
  Shipment:
    id:
      name: ShipmentId
      type: id-ne
      
    properties:
    
      ShipmentTypeId:
        type: id
        
      StatusId:
        type: id
        referenceType: StatusItem

      PrimaryOrderId:
        type: id
      PrimaryReturnId:
        type: id
      # PrimaryShipGroupSeqId:
        # type: id
      PicklistBinId:
        type: id
      EstimatedReadyDate:
        type: date-time
      EstimatedShipDate:
        type: date-time
      EstimatedShipWorkEffId:
        type: id
      EstimatedArrivalDate:
        type: date-time
      EstimatedArrivalWorkEffId:
        type: id
      LatestCancelDate:
        type: date-time
      EstimatedShipCost:
        type: currency-amount
      CurrencyUomId:
        type: id
      HandlingInstructions:
        type: long-varchar
      OriginFacilityId:
        type: id
      DestinationFacilityId:
        type: id
      OriginContactMechId:
        type: id
      OriginTelecomNumberId:
        type: id
      DestinationContactMechId:
        type: id
      DestinationTelecomNumberId:
        type: id
      PartyIdTo:
        type: id
      PartyIdFrom:
        type: id
      AdditionalShippingCharge:
        type: currency-amount
      AddtlShippingChargeDesc:
        type: long-varchar
      # CreatedDate:
        # type: date-time
      # CreatedByUserLogin:
        # type: id-vlong
      # LastModifiedDate:
        # type: date-time
      # LastModifiedByUserLogin:
        # type: id-vlong
        
      # --------------------------------
      # 运输商 Id.
      ShipperId:
        type: id
      
      ShipmentItems:
        itemType: ShipmentItem
      ShipmentReceipts:
        itemType: ShipmentReceipt
        
    references: {}
    
    reservedProperties:
      # createdAt: CreatedDate
      # createdBy: CreatedByUserLogin
      # updatedAt: LastModifiedDate
      # updatedBy: LastModifiedByUserLogin
      noDeleted: true
      
    discriminator: ShipmentTypeId
    
    # metadata: 
      # StateEventDatabaseTableName: SHIPMENT_STATE_EVENT
      
    entities:
    
      # ------------------------------------------
      # 装运项（行）
      ShipmentItem:
        id:
          name: ShipmentItemSeqId
          type: id
          # name: ShipmentItemId
          # type: ShipmentItemId
          
        properties:
        
          ProductId:
            type: id-long
            
          AttributeSetInstanceId:
            type: string
          
          # 装运数量
          Quantity:
            type: fixed-point
            notNull: true
          
          # 目标数量
          TargetQuantity:
            type: fixed-point
            description: The Quantity which should be shipped.
            
          ShipmentContentDescription:
            type: description
            
        # references:
          # Shipment:
            # name: Shipment
            # displayName: Shipment
            # type: Shipment
            # properties:
            # - ShipmentItemId.ShipmentId
            # foreignKeyName: SHPMNT_ITM_SHPMT
            
        reservedProperties: 
          noDeleted: true
          
        # valueObjects:        
          # ShipmentItemId:
            # properties:
              # ShipmentId:
                # type: id-ne
              # ShipmentItemSeqId:
                # type: id-ne
        # metadata: 
          # StateEventDatabaseTableName: SHIPMENT_ITEM_STATE_EVENT

      # ------------------------------------------
      # 装运（行）接收记录
      ShipmentReceipt:
        id:
          name: ReceiptSeqId
          type: id
          # name: ReceiptId
          
        properties:
        
          ProductId:
            type: id-long
            
          AttributeSetInstanceId:
            type: string
            
          # 装运项（行）序列 Id.
          ShipmentItemSeqId:
            type: id
            
          # InventoryItemId:
            # type: id
          # ShipmentId:
            # type: id
          # ShipmentPackageSeqId:
            # type: id
          # OrderId:
            # type: id
          # OrderItemSeqId:
            # type: id
          # ReturnId:
            # type: id
          # ReturnItemSeqId:
            # type: id
          
          # -----------------------------------
          # 拒收原因 Id.
          RejectionReasonId:
            type: id-long
            referenceType: RejectionReason
          
          # 损坏状态 Id.
          DamageStatusId:
            type: id
            referenceType: StatusItem
          
          # 损坏原因 Id.
          DamageReasonId:
            type: id-long
            referenceType: DamageReason
          # -----------------------------------
            
          ReceivedBy:
            type: id-vlong
          DatetimeReceived:
            type: date-time
            
          ItemDescription:
            type: description
            
          # 接受数量
          AcceptedQuantity:
            type: fixed-point
            notNull: true
            
          # 拒收数量
          RejectedQuantity:
            type: fixed-point
            notNull: true
          
          # 损坏数量
          DamagedQuantity:
            type: fixed-point
            notNull: true
            
        # references: {}
        
        reservedProperties:
          noDeleted: true
          
        # metadata:
          # StateEventDatabaseTableName: SHIPMENT_RECEIPT_STATE_EVENT
          
    # ---------------------------------
    methods:
    
      # --------------------------------------
      # 导入装运单
      Import:
        parameters:
          ShipmentTypeId:
            type: id
          PrimaryOrderId:
            type: id
          PrimaryReturnId:
            type: id
          EstimatedReadyDate:
            type: date-time
          EstimatedShipDate:
            type: date-time
          # EstimatedShipWorkEffId:
            # type: id
          EstimatedArrivalDate:
            type: date-time
          # EstimatedArrivalWorkEffId:
            # type: id
          LatestCancelDate:
            type: date-time
          EstimatedShipCost:
            type: currency-amount
          CurrencyUomId:
            type: id
          HandlingInstructions:
            type: long-varchar
          OriginFacilityId:
            type: id
          DestinationFacilityId:
            type: id
          PartyIdTo:
            type: id
          PartyIdFrom:
            type: id
          AdditionalShippingCharge:
            type: currency-amount
          AddtlShippingChargeDesc:
            type: long-varchar

          # ------------------------
          # 导入的装运项（行）
          ShipmentItems:
            itemType: ImportingShipmentItem
            
      # --------------------------------------
      # 发出装运单
      Ship:
        parameters:

      # --------------------------------------
      # 接收一个装运项
      ReceiveItem:
        parameters:
          ShipmentItemSeqId:
            type: id
          # -----------------------------------
          # ProductId:
            # type: id-long
          # AttributeSetInstanceId:
            # type: string
          AttributeSetInstance:
            type: map
          RejectionReasonId:
            type: id
            referenceType: RejectionReason
          DamageStatusId:
            type: id
            referenceType: StatusItem
          DamageReasonId:
            type: id
            referenceType: DamageReason
          AcceptedQuantity:
            type: fixed-point
          RejectedQuantity:
            type: fixed-point
          DamagedQuantity:
            type: fixed-point
          # -----------------------------------
          ItemDescription:
            type: description
      
      # --------------------------------------
      # 确认所有装运项已接收
      ConfirmAllItemsReceived:
        parameters:
      
      
    # ---------------------------------
    valueObjects:
      # ---------------------------------
      # 导入的装运项（行）信息
      ImportingShipmentItem:
        properties:
          ShipmentItemSeqId:
            type: id
          ProductId:
            type: id-long
          Quantity:
            type: fixed-point
          TargetQuantity:
            type: fixed-point
            description: The Quantity which should be shipped.
          ShipmentContentDescription:
            type: description
          # --------------------------------
          # 属性集实例。这里是一个 Map
          AttributeSetInstance:
            type: map
              
# # ---------------------------------    
# valueObjects:
  # KeyValuePair:
    # properties:
      # Key:
        # type: string
      # Value:
        # type: object
        
        
    